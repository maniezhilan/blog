---
layout: post
title: Seam Chat (gmail like chat) Example with SMACK API
date: '2009-06-03T08:01:00.000-05:00'
author: Maniezhilan shanmugam
tags:
- seam
modified_time: '2012-09-03T21:11:38.014-05:00'
blogger_id: tag:blogger.com,1999:blog-5289317672382806955.post-6704858884681378445
blogger_orig_url: http://maniezhilan.blogspot.com/2009/06/seam-chat-gmail-like-chat-example-with.html
---

<script src="http://crux-framework-tools.googlecode.com/svn/trunk/misc/highlight/highlightLoader.js">type='text/javascript' </script>For one of my projects i wanted to develop an simple chat application , something like gmail chat.<br />The things i should consider before start were , the existing technology the project is developed (with Seam framework and richfaces) , also it should be reusable across different websites ( hence ability to handle huge volume of traffic). Richfaces &lt;a4j:poll&gt; is the easy and simple way of building an asynchronous chat (i will blog about this later). But the draw back is it has to keep polling the database tables for chat related data (performance bottleneck) and no DBA wants to store in the DB people's howdy 's and LOL's.<br /><br />Earlier in our company we had Openfire installed for developers to communicate among themselves inside NetBeans IDE .  So i thought of giving a try on setup like that, which led me into SMACK API.  After some googling i hit upon an <a href="http://today.java.net/pub/a/today/2006/10/05/instant-messaging-for-jabber-with-smack.html">excellent article</a>  in java.net by <a href="http://today.java.net/pub/au/431">John Ferguson Smart</a> which helped me a lot in  understanding about the SMACK API.<br /><br />I dont want to explain here about SMACK API, but i will explain how i integrated it with Seam and richfaces.<br /><br />1. Created an Seam Action Class as follows , for brevity omitting getters and setters<br /><pre class="brush:java">@Scope(ScopeType.SESSION)<br />@Name("chataction")<br />public class ChatAction{<br /><br />private static XMPPConnection connection = null;<br />private String tomessage;<br />private String frommessage;<br />private List<string> conversationList=new ArrayList<string>();<br /></pre><br /><br /><br />2. Wrote an method as follows to get the XMPPConnection.<br /><pre class="brush:java">private static  XMPPConnection getConnection(){<br />if(connection == null) {<br />connection = new XMPPConnection("gmail.com");<br />try{<br />connection.connect();<br />connection.login("websiteuserlogin@gmail.com","password");<br />}catch(XMPPException xmppe){<br />xmppe.printStackTrace();<br />}<br />}<br />return connection;<br />}<br /><br /></pre><br /><br />3. Check for the Contacts /Chat users availability.<br /><br /><pre class="brush:java">public boolean chatAvailability(){<br />Roster roster = getConnection().getRoster();<br />Presence presence = roster.getPresence("websitechatadmin@gmail.com");<br />if (presence.getType() == Presence.Type.available) {<br />return true;<br />}<br />return false;<br />}<br /><br /></pre><br /><br />4. Start Chat method.<br /><br /><br /><pre class="brush:java">public void startChat(){<br /><br />try{<br />XMPPConnection connection =  getConnection();<br />ChatManager chatmanager = connection.getChatManager();<br />Chat chat = chatmanager.createChat(websitechatadmin@gmail.com, null);<br />Message msgObj = new Message(to, Message.Type.chat);<br />conversationList.add("<b> me :</b> "+getTomessage());<br />msgObj.setBody(getTomessage());<br />chat.sendMessage(msgObj);<br />setTomessage("");<br /><br />// Accept only messages from<br />PacketFilter filter<br />= new AndFilter(new PacketTypeFilter(Message.class),<br />new FromContainsFilter(to));<br /><br />// Collect these messages<br />PacketCollector collector = connection.createPacketCollector(filter);<br /><br />Packet packet = collector.pollResult();<br /><br />PacketListener myListener = new PacketListener() {<br />public void processPacket(Packet packet) {<br />if (packet instanceof Message) {<br />Message msg = (Message) packet;<br />if(msg!=null &amp;&amp; !conversationList.contains("<b>website chat admin:</b> "+msg.getBody())){<br />// Process message by adding to conversationList<br />conversationList.add("<b>website chat admin:</b> "+msg.getBody());<br />}<br />}<br />}<br />};<br />// Register the listener.<br />connection.addPacketListener(myListener, filter);<br />}catch (Exception e) {<br />e.printStackTrace();<br />}<br /><br />}<br /></pre><br /><br />5. Stop chat method.<br /><br /><pre class="brush:java">public void stopChat(){<br /><br />if(connection!=null){<br />connection.disconnect();<br />}<br />if(conversationList!=null){<br />conversationList.clear();<br />}<br />}<br /></pre><br /><br />6. Create chat.xhtml , i used &lt;a4j:poll&gt; to keep polling the server for message replies and updating the chat window on the browser.<br /><br /><pre class="brush:html">&lt;!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"<br />"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;<br />&lt;ui:composition xmlns="http://www.w3.org/1999/xhtml"<br />xmlns:s="http://jboss.com/products/seam/taglib"<br />xmlns:ui="http://java.sun.com/jsf/facelets"<br />xmlns:f="http://java.sun.com/jsf/core"<br />xmlns:h="http://java.sun.com/jsf/html"<br />xmlns:a4j="http://richfaces.org/a4j"<br />xmlns:rich="http://richfaces.org/rich"&gt;<br /><br />&lt;ui:define name="body"&gt;<br />&lt;a4j:region&gt;<br />&lt;h:form&gt;<br />&lt;a4j:poll id="poll" interval="1000"  reRender="chatwindow,chat"/&gt;<br />&lt;/h:form&gt;<br />&lt;/a4j:region&gt;<br /><br />&lt;a4j:form&gt;<br />&lt;a4j:outputPanel id="chatwindow"&gt;<br /><br />&lt;h:outputText  value="User  is unavailable try again later....." rendered="#{!chataction.chatAvailability()}"/&gt;<br />&lt;ui:repeat value="#{chataction.conversationList}" var="frommesg"&gt;<br />&lt;h:outputText value="#{frommesg}" escape="false" /&gt;&lt;br&gt;&lt;/br&gt;<br />&lt;/ui:repeat&gt;<br /><br />&lt;/a4j:outputPanel&gt;<br /><br />&lt;/a4j:form&gt;<br />&lt;a4j:form&gt;<br /><br />&lt;h:inputText id="txtbox" value="#{chataction.tomessage}" /&gt;<br />&lt;br&gt;&lt;/br&gt;<br /><br />&lt;a4j:commandButton id="chat" value="Chat"  action="#{chataction.startChat()}"  reRender="chatwindow,txtbox"/&gt;<br />&lt;/a4j:form&gt;<br /><br />&lt;/ui:define&gt;<br />&lt;/ui:composition&gt;<br /></pre><br /><br />maven project source code can be downloaded from <a href="http://maniezhilan.googlepages.com/seamchat.zip">here</a><br /><br /><a href="http://click.linksynergy.com/fs-bin/click?id=RcoVQU7h/OY&amp;offerid=141510.10000014&amp;type=4&amp;subid=0"><img border=0 alt="Banner 468x60" src="http://images.compusa.com/adserve/compusa_default_468x60.gif"></a><img border=0 width=1 height=1 alt=banner src="http://ad.linksynergy.com/fs-bin/show?id=RcoVQU7h/OY&amp;bids=141510.10000014&type=4&amp;subid=0">