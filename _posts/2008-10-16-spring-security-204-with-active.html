---
layout: post
title: Spring Security 2.0.4 with Active Directory Example
date: '2008-10-16T08:08:00.000-05:00'
author: Maniezhilan shanmugam
tags:
- spring security
modified_time: '2012-09-01T19:43:35.303-05:00'
blogger_id: tag:blogger.com,1999:blog-5289317672382806955.post-3006117510464850570
blogger_orig_url: http://maniezhilan.blogspot.com/2008/10/spring-security-204-with-active.html
---

<script src="http://crux-framework-tools.googlecode.com/svn/trunk/misc/highlight/highlightLoader.js">type='text/javascript' </script>Here i will explain how to authenticate and authorize users against Windows Active directory using the latest spring security version 2.0.4. The Spring security LDAP samples helped me making this work.  <br /><br /><span style="font-weight:bold;">1.</span> I used maven to build this , the contents of my pom.xml are as follows, <br /><pre name="code" class="brush:xml">&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"<br />xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"&gt;<br />&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;<br />&lt;groupId&gt;com.mani&lt;/groupId&gt;<br />&lt;artifactId&gt;loginAD&lt;/artifactId&gt;<br />&lt;packaging&gt;war&lt;/packaging&gt;<br />&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;<br />&lt;name&gt;loginAD Maven Webapp&lt;/name&gt;<br />&lt;url&gt;http://maven.apache.org&lt;/url&gt;<br />&lt;dependencies&gt;<br />&lt;dependency&gt;<br />&lt;groupId&gt;junit&lt;/groupId&gt;<br />&lt;artifactId&gt;junit&lt;/artifactId&gt;<br />&lt;version&gt;3.8.1&lt;/version&gt;<br />&lt;scope&gt;test&lt;/scope&gt;<br />&lt;/dependency&gt;<br />&lt;dependency&gt;<br />&lt;groupId&gt;org.springframework.security&lt;/groupId&gt;<br />&lt;artifactId&gt;spring-security-core&lt;/artifactId&gt;<br />&lt;version&gt;2.5.0-SNAPSHOT&lt;/version&gt;<br />&lt;/dependency&gt;<br />&lt;dependency&gt;<br />&lt;groupId&gt;org.springframework&lt;/groupId&gt;<br />&lt;artifactId&gt;spring-web&lt;/artifactId&gt;<br />&lt;version&gt;2.0.8&lt;/version&gt;<br />&lt;/dependency&gt;<br />&lt;dependency&gt;<br />&lt;groupId&gt;org.springframework&lt;/groupId&gt;<br />&lt;artifactId&gt;spring-jdbc&lt;/artifactId&gt;<br />&lt;version&gt;2.0.8&lt;/version&gt;<br />&lt;/dependency&gt;<br />&lt;dependency&gt;<br />&lt;groupId&gt;org.springframework&lt;/groupId&gt;<br />&lt;artifactId&gt;spring-aop&lt;/artifactId&gt;<br />&lt;version&gt;2.0.8&lt;/version&gt;<br />&lt;/dependency&gt;<br />&lt;dependency&gt;<br />&lt;groupId&gt;org.slf4j&lt;/groupId&gt;<br />&lt;artifactId&gt;slf4j-log4j12&lt;/artifactId&gt;<br />&lt;version&gt;1.4.3&lt;/version&gt;<br />&lt;/dependency&gt;<br />&lt;dependency&gt;<br />&lt;groupId&gt;org.springframework.ldap&lt;/groupId&gt;<br />&lt;artifactId&gt;spring-ldap&lt;/artifactId&gt;<br />&lt;version&gt;1.2.1&lt;/version&gt;<br />&lt;/dependency&gt;<br />&lt;!-- Log4J --&gt;<br />&lt;dependency&gt;<br />&lt;groupId&gt;log4j&lt;/groupId&gt;<br />&lt;artifactId&gt;log4j&lt;/artifactId&gt;<br />&lt;version&gt;1.2.14&lt;/version&gt;<br />&lt;/dependency&gt;<br />&lt;/dependencies&gt;<br />&lt;build&gt;<br />&lt;finalName&gt;loginAD&lt;/finalName&gt;<br />&lt;/build&gt;<br />&lt;/project&gt;<br /><br /></pre><br /><br /><span style="font-weight:bold;">2.</span> The web.xml of my application is as follows. <br /><pre name="code" class="brush:xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br /><br />&lt;web-app xmlns="http://java.sun.com/xml/ns/j2ee"<br />xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"<br />xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd" version="2.4"&gt;<br /><br />&lt;display-name&gt;Active Directory Based Login Application&lt;/display-name&gt;<br /><br />&lt;!--<br />- Location of the XML file that defines the root application context<br />- Applied by ContextLoaderListener.<br />--&gt;<br />&lt;context-param&gt;<br />&lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;<br />&lt;param-value&gt;<br />/WEB-INF/applicationContext-security.xml<br />&lt;/param-value&gt;<br />&lt;/context-param&gt;<br /><br />&lt;filter&gt;<br />&lt;filter-name&gt;springSecurityFilterChain&lt;/filter-name&gt;<br />&lt;filter-class&gt;org.springframework.web.filter.DelegatingFilterProxy&lt;/filter-class&gt;<br />&lt;/filter&gt;<br /><br />&lt;filter-mapping&gt;<br />&lt;filter-name&gt;springSecurityFilterChain&lt;/filter-name&gt;<br />&lt;url-pattern&gt;/*&lt;/url-pattern&gt;<br />&lt;/filter-mapping&gt;<br /><br />&lt;!--<br />- Loads the root application context of this web app at startup.<br />- The application context is then available via<br />- WebApplicationContextUtils.getWebApplicationContext(servletContext).<br />--&gt;<br />&lt;listener&gt;<br />&lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;<br />&lt;/listener&gt;<br /><br />&lt;!--<br />- Publishes events for session creation and destruction through the application<br />- context. Optional unless concurrent session control is being used.<br />--&gt;<br />&lt;listener&gt;<br />&lt;listener-class&gt;org.springframework.security.ui.session.HttpSessionEventPublisher&lt;/listener-class&gt;<br />&lt;/listener&gt;<br /><br />&lt;/web-app&gt;<br /></pre><br /><br /><span style="font-weight:bold;">3.</span> The last but not the least applicationContext-security.xml. I used the sAMAccountName which is my login id. Moreover i used the port 3268 to look for the entire AD. You can use the port 389 instead too(based on your AD search). <br /><br />The things configured in this xml file are ,  <br />a) Login to the AD with UserDn /passoword to get the LDAPCONTEXT and then search for the user based on the sAMAccountName in the LDAPCONTEXT. When the user is found, populate his authorities. <br /><br /><pre name="code" class="brush:xml">&lt;beans xmlns="http://www.springframework.org/schema/beans"<br />xmlns:s="http://www.springframework.org/schema/security"<br />xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"<br />xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd<br />http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security-2.0.1.xsd"&gt;<br />&lt;s:http&gt;<br />&lt;s:intercept-url pattern="/secure/extreme/**" access="ROLE_eCommunications"/&gt;<br />&lt;s:intercept-url pattern="/secure/**" access="IS_AUTHENTICATED_REMEMBERED"/&gt;<br />&lt;s:intercept-url pattern="/**" access="IS_AUTHENTICATED_ANONYMOUSLY"/&gt;<br />&lt;s:form-login/&gt;<br />&lt;s:anonymous/&gt;<br />&lt;s:logout/&gt;<br />&lt;/s:http&gt;<br /><br /><br />&lt;bean id="contextSource" class="org.springframework.security.ldap.DefaultSpringSecurityContextSource"&gt;<br />&lt;constructor-arg value="ldap://server.url.goes.here:3268/DC=example,DC=com?sAMAccountName?sub?(objectClass=*)"/&gt;<br />&lt;property name="userDn" value="username"/&gt;<br />&lt;property name="password" value="password"/&gt;<br /><br />&lt;/bean&gt;<br /><br />&lt;bean id="secondLdapProvider" class="org.springframework.security.providers.ldap.LdapAuthenticationProvider"&gt;<br />&lt;s:custom-authentication-provider /&gt;<br />&lt;constructor-arg&gt;<br />&lt;bean class="org.springframework.security.providers.ldap.authenticator.BindAuthenticator"&gt;<br />&lt;constructor-arg ref="contextSource"/&gt;<br />&lt;property name="userSearch"&gt;<br />&lt;bean id="userSearch" class="org.springframework.security.ldap.search.FilterBasedLdapUserSearch"&gt;<br />&lt;constructor-arg index="0" value=""/&gt;<br />&lt;constructor-arg index="1" value="(&amp;(sAMAccountName={0})(objectclass=user))"/&gt;<br />&lt;constructor-arg index="2" ref="contextSource" /&gt;<br />&lt;/bean&gt;    <br />&lt;/property&gt;<br />&lt;/bean&gt;<br />&lt;/constructor-arg&gt;<br />&lt;constructor-arg&gt; <br />&lt;bean class="org.springframework.security.ldap.populator.DefaultLdapAuthoritiesPopulator"&gt;<br />&lt;constructor-arg ref="contextSource" /&gt;<br />&lt;constructor-arg value="" /&gt;<br />&lt;property name="rolePrefix" value="ROLE_"/&gt;<br />&lt;property name="searchSubtree" value="true"/&gt;<br />&lt;property name="convertToUpperCase" value="false"/&gt;<br />&lt;/bean&gt;<br />&lt;/constructor-arg&gt;<br /><br />&lt;/bean&gt;<br />&lt;/beans&gt;<br /></pre><br /><br /><span style="font-weight:bold;">4.</span> My index.jsp under my webapp is as follows. <br /><pre name="code" class="brush:html"><html><br /><body><br /><h1>Home Page</h1><p>Anyone can view this page.</p><p>Your principal object is....: <%= request.getUserPrincipal() %></p><p><a href="secure/index.jsp">Secure page</a></p><p><a href="secure/extreme/index.jsp">Extremely secure page</a></p></body><br /></html><br /></pre><br /><br /><span style="font-weight:bold;">5.</span>Under webapp/secure index.jsp is as follows <br /><pre name="code" class="brush:html"><html><br /><body><br /><h1>Secure Page</h1>This is a protected page. You can get to me if you've been remembered,<br />or if you've authenticated this session.<br /><br /><br /><br /><%if (request.isUserInRole("ROLE_SUPERVISOR")) { %><br />You are a supervisor! You can therefore see the <a href="extreme/index.jsp">extremely secure page</a>.<br /><br /><br /><% } %><br /><br /><br /><p><a href="../">Home</a><br /><p><a href="../j_spring_security_logout">Logout</a><br /></body><br /></html><br /></pre><br /><span style="font-weight:bold;">6.</span> Under secure/extreme/index.jsp its as follows <br /><pre name="code" class="brush:html"><html><br /><body><br /><h1>VERY Secure Page</h1>This is a protected page. You can only see me if you belong to SUPERVISOR<br /><br /><p><a href="../../">Home</a><br /><p><a href="../../j_spring_security_logout">Logout</a><br /></body><br /></html><br /></pre><br /><br /><br /><br /><span style="font-weight:bold;">7.</span> Deploy on tomcat and access using url http://localhost:8080/loginAD <br /><br /><br />Soon i will post a <a href="http://maniezhilan.blogspot.com/2009/02/custom-authentication-using-spring.html">blog</a> about customizing the spring security authentication provider for authentication against Active directory using domain name / username as login <br /><br />